<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>CareerVR ‚Äì N·ªÅn t·∫£ng H∆∞·ªõng nghi·ªáp AI & VR</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0b1220;color:#e6f0ff}
    header{display:flex;gap:16px;align-items:center;padding:16px 20px;background:#0e1a33;border-bottom:1px solid #1e2a44;position:sticky;top:0;z-index:20}
    header h1{font-size:18px;margin:0}
    nav a{color:#9fb7ff;text-decoration:none;margin-right:14px}
    nav a.active{color:#fff;font-weight:bold}

    .container{max-width:1100px;margin:0 auto;padding:20px}
    .page{display:none}

    .card{background:#0f1f3a;border:1px solid #1e2a44;border-radius:12px;padding:16px;margin-bottom:16px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;background:#081225;border:1px solid #2a3b66;color:#cfe0ff}
    .muted{color:#9fb7ff}

    .major{padding:10px 12px;border-radius:10px;background:#081225;border:1px solid #1e2a44;margin-bottom:10px}
    .major h4{margin:0 0 6px 0;font-size:15px}
    .major p{margin:0;color:#cfe0ff;font-size:13px;line-height:1.45}

    button{padding:10px 14px;border-radius:8px;border:none;background:#1a3cff;color:#fff;cursor:pointer}
    button.ghost{background:#0f1f3a;border:1px solid #2a3b66}

    input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid #2a3b66;background:#081225;color:#fff}

    .scale{display:flex;justify-content:space-between;font-size:12px;color:#9fb7ff;margin-top:6px;gap:8px;flex-wrap:wrap}

    .tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .tab{flex:1;min-width:220px;padding:8px;border-radius:8px;text-align:center;cursor:pointer;background:#081225;border:1px solid #1e2a44}
    .tab.active{background:#1a3cff}

    .question{margin-bottom:12px}
    .options{display:flex;gap:10px;flex-wrap:wrap}

    .progress{height:10px;background:#081225;border-radius:6px;overflow:hidden;margin-bottom:6px}
    .bar{height:100%;width:0;background:#1a3cff}

    ul{margin:8px 0 0 18px}
  </style>
</head>
<body>
<header>
  <h1>CareerVR</h1>
  <nav>
    <a href="#home" data-page="home" class="nav active">Trang ch·ªß</a>
    <a href="#riasec" data-page="riasec" class="nav">RIASEC Test</a>
    <a href="#experience" data-page="experience" class="nav">Tr·∫£i nghi·ªám ngh·ªÅ</a>
    <a href="#chatbot" data-page="chatbot" class="nav">Chatbot AI</a>
    <a href="#dashboard" data-page="dashboard" class="nav">Dashboard</a>
  </nav>
</header>

<div class="container">

<!-- HOME -->
<section class="page" id="home" style="padding:0">
  <div style="position:relative;height:80vh;width:100%;overflow:hidden;border-radius:12px;border:1px solid #1e2a44">
    <video autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover">
      <source src="assets/intro.mp4" type="video/mp4">
    </video>
    <div style="position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(11,18,32,.9));display:flex;align-items:center;justify-content:center">
      <div style="text-align:center;max-width:760px;padding:20px">
        <h2 style="font-size:32px;margin:0 0 12px 0">CareerVR ‚Äì N·ªÅn t·∫£ng H∆∞·ªõng nghi·ªáp AI & VR</h2>
        <p style="color:#cfe0ff;font-size:16px;margin:0 0 20px 0">Kh√°m ph√° b·∫£n th√¢n ‚Äì Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp ‚Äì ƒê·ªãnh h∆∞·ªõng t∆∞∆°ng lai b·∫±ng c√¥ng ngh·ªá AI v√† VR.</p>
        <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
          <button onclick="go('riasec')">Tr·∫Øc nghi·ªám RIASEC</button>
          <button class="ghost" onclick="go('experience')">Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp</button>
        </div>
        <p class="muted" style="margin-top:14px;font-size:13px">L∆∞u √Ω: video gi·ªõi thi·ªáu ƒë·∫∑t t·∫°i <span class="pill">assets/intro.mp4</span></p>
      </div>
    </div>
  </div>
</section>

<!-- RIASEC -->
<section class="page" id="riasec">
  <div class="card">
    <h3 style="margin-top:0">Th√¥ng tin h·ªçc sinh</h3>
    <label>H·ªç v√† t√™n</label><input id="name" type="text" placeholder="Nguy·ªÖn VƒÉn A" />
    <label style="margin-top:10px">L·ªõp</label><input id="cls" type="text" placeholder="10A1" />
    <label style="margin-top:10px">Tr∆∞·ªùng</label><input id="school" type="text" placeholder="THPT ..." />
  </div>

  <div class="card">
    <strong>Ti·∫øn tr√¨nh tr·∫£ l·ªùi</strong>
    <div class="progress" style="margin-top:8px"><div class="bar" id="bar"></div></div>
    <div id="progressText" class="muted">0 / 50 c√¢u</div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab(0)">PH·∫¶N 1 ‚Äì S·ªü th√≠ch & T√≠nh c√°ch (1‚Äì24)</div>
    <div class="tab" onclick="showTab(1)">PH·∫¶N 2 ‚Äì NƒÉng l·ª±c & K·ªπ nƒÉng (25‚Äì38)</div>
    <div class="tab" onclick="showTab(2)">PH·∫¶N 3 ‚Äì Gi√° tr·ªã & Mong mu·ªën (39‚Äì46)</div>
    <div class="tab" onclick="showTab(3)">PH·∫¶N 4 ‚Äì ƒêi·ªÅu ki·ªán th·ª±c t·∫ø (47‚Äì50)</div>
  </div>

  <!-- Thang ƒëo d√πng chung -->
  <div class="card" id="scaleHint">
    <strong>Thang ƒëo d√πng chung</strong>
    <div class="scale">
      <span>1. R·∫•t kh√¥ng ƒë√∫ng</span>
      <span>2. Kh√¥ng ƒë√∫ng</span>
      <span>3. Ph√¢n v√¢n</span>
      <span>4. ƒê√∫ng</span>
      <span>5. R·∫•t ƒë√∫ng</span>
    </div>
    <div class="muted" style="margin-top:8px;font-size:13px">Thang ƒëo √°p d·ª•ng cho t·∫•t c·∫£ c√¢u h·ªèi (1‚Äì50).</div>
  </div>

  <form id="riasecForm" class="card">
    <div id="questions"></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
      <button type="submit">Ho√†n th√†nh & Xem k·∫øt qu·∫£</button>
      <button type="button" class="ghost" onclick="resetRiasec()">L√†m l·∫°i</button>
    </div>
    <div class="muted" style="margin-top:10px;font-size:13px">Kh√¥ng b·∫Øt bu·ªôc l√†m ƒë·ªß 50 c√¢u. Tuy nhi√™n, ƒë·ªÉ k·∫øt qu·∫£ ch√≠nh x√°c h∆°n, n√™n tr·∫£ l·ªùi c√†ng nhi·ªÅu c√†ng t·ªët.</div>
  </form>

  <div class="card" id="riasecResult" style="display:none">
    <h3 style="margin-top:0">K·∫øt qu·∫£ tr·∫Øc nghi·ªám</h3>
    <div id="riasecTop"></div>
    <div style="margin-top:10px">
      <strong>Ng√†nh/nh√≥m ng√†nh g·ª£i √Ω (2‚Äì3) + 1 d·ª± ph√≤ng</strong>
      <div id="majorList" style="margin-top:8px"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button type="button" onclick="go('experience')">T·ªõi Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp</button>
      <button type="button" class="ghost" onclick="go('chatbot')">H·ªèi Chatbot AI</button>
    </div>
  </div>
</section>

<!-- EXPERIENCE -->
<section class="page" id="experience">
  <div class="card">
    <h3 style="margin-top:0">Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp</h3>
    <p class="muted" style="margin-top:0">D·ªØ li·ªáu g·ª£i √Ω l·∫•y t·ª´ k·∫øt qu·∫£ tr·∫Øc nghi·ªám g·∫ßn nh·∫•t.</p>
    <div id="careerSuggest"></div>
  </div>
</section>

<!-- CHATBOT -->
<section class="page" id="chatbot">
  <div class="card">
    <h3 style="margin-top:0">Chatbot AI H∆∞·ªõng nghi·ªáp</h3>

    <!-- Ng·ªØ c·∫£nh RIASEC -->
    <div id="chatContext" style="margin-bottom:12px"></div>

    <!-- Dify Chatbot -->
    <div style="
      border:1px solid #1e2a44;
      border-radius:12px;
      overflow:hidden;
      background:#081225;
    ">
      <iframe
        src="https://udify.app/chatbot/wbtIvVFUR8FiB0Kg"
        style="width:100%; min-height:700px; border:none"
        allow="microphone; clipboard-write"
      ></iframe>
    </div>

    <div class="muted" style="margin-top:10px;font-size:13px">
      üí° G·ª£i √Ω: B·∫°n c√≥ th·ªÉ h·ªèi AI v·ªÅ ng√†nh h·ªçc ph√π h·ª£p, t·ªï h·ª£p m√¥n, l·ªô tr√¨nh h·ªçc sau THPT d·ª±a tr√™n RIASEC.
    </div>
  </div>
</section>
<!-- DASHBOARD -->
<section class="page" id="dashboard">
  <div class="card">
    <h3 style="margin-top:0">Dashboard th·ªëng k√™</h3>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px">
      <button type="button" class="ghost" onclick="clearAllData()">Xo√° d·ªØ li·ªáu (local)</button>
      <span class="muted" style="align-self:center;font-size:13px">Ch·ªâ xo√° tr√™n tr√¨nh duy·ªát hi·ªán t·∫°i</span>
    </div>
    <div id="dashboardData"></div>
  </div>
</section>

</div>

<script>
(() => {
  // ===== Helpers =====
  const $ = (id) => document.getElementById(id);
  const DB_KEY = 'careerVR';
  const readDB = () => {
    try { return JSON.parse(localStorage.getItem(DB_KEY) || '[]'); }
    catch { return []; }
  };
  const writeDB = (arr) => localStorage.setItem(DB_KEY, JSON.stringify(arr));

  // ===== SPA navigation =====
  const pages = Array.from(document.querySelectorAll('.page'));
  const navs = Array.from(document.querySelectorAll('.nav'));

  window.go = function go(pageId) {
    pages.forEach(p => p.style.display = (p.id === pageId) ? 'block' : 'none');
    navs.forEach(a => a.classList.toggle('active', a.dataset.page === pageId));
    if (pageId === 'experience') syncExperienceFromLast();
    if (pageId === 'chatbot') showChat();
    if (pageId === 'dashboard') showDashboard();
    try { history.replaceState(null, '', '#' + pageId); } catch {}
  };

  navs.forEach(a => a.addEventListener('click', (e) => {
    e.preventDefault();
    go(a.dataset.page);
  }));

  window.addEventListener('hashchange', () => {
    const h = (location.hash || '#home').replace('#', '');
    if (pages.some(p => p.id === h)) go(h);
  });

  // ===== RIASEC + 50 c√¢u h·ªèi (ƒë√∫ng theo t√†i li·ªáu) + ch·∫•m ƒëi·ªÉm RIASEC cho c·∫£ 50 c√¢u =====
  const riasecQuestions = [
    // PH·∫¶N 1 ‚Äì S·ªû TH√çCH & T√çNH C√ÅCH (RIASEC) (1‚Äì24)
    {t:'C√¢u 1: T√¥i th√≠ch s·ª≠a ch·ªØa, l·∫Øp r√°p ƒë·ªì ƒë·∫°c ho·∫∑c thi·∫øt b·ªã.', r:'R'},
    {t:'C√¢u 2: T√¥i h·ª©ng th√∫ v·ªõi c√°c c√¥ng vi·ªác c·∫ßn v·∫≠n ƒë·ªông ho·∫∑c l√†m ngo√†i tr·ªùi.', r:'R'},
    {t:'C√¢u 3: T√¥i th√≠ch l√†m vi·ªác v·ªõi c√¥ng c·ª•, m√°y m√≥c h∆°n l√† gi·∫•y t·ªù.', r:'R'},
    {t:'C√¢u 4: T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c l√†m tr·ª±c ti·∫øp thay v√¨ ch·ªâ nghe gi·∫£ng.', r:'R'},
    {t:'C√¢u 5: T√¥i th√≠ch t√¨m hi·ªÉu nguy√™n nh√¢n ‚Äì k·∫øt qu·∫£ c·ªßa m·ªôt v·∫•n ƒë·ªÅ.', r:'I'},
    {t:'C√¢u 6: T√¥i th√≠ch c√°c m√¥n h·ªçc c·∫ßn suy lu·∫≠n nh∆∞ To√°n, L√Ω, H√≥a.', r:'I'},
    {t:'C√¢u 7: T√¥i th∆∞·ªùng ƒë·∫∑t c√¢u h·ªèi ‚Äúv√¨ sao‚Äù khi h·ªçc ki·∫øn th·ª©c m·ªõi.', r:'I'},
    {t:'C√¢u 8: T√¥i th√≠ch ph√¢n t√≠ch d·ªØ li·ªáu, th√≠ nghi·ªám ho·∫∑c nghi√™n c·ª©u.', r:'I'},
    {t:'C√¢u 9: T√¥i th√≠ch v·∫Ω, vi·∫øt, thi·∫øt k·∫ø ho·∫∑c s√°ng t·∫°o n·ªôi dung.', r:'A'},
    {t:'C√¢u 10: T√¥i kh√¥ng th√≠ch c√¥ng vi·ªác qu√° khu√¥n m·∫´u, l·∫∑p l·∫°i.', r:'A'},
    {t:'C√¢u 11: T√¥i th√≠ch th·ªÉ hi·ªán √Ω t∆∞·ªüng v√† c·∫£m x√∫c c√° nh√¢n.', r:'A'},
    {t:'C√¢u 12: T√¥i h·ª©ng th√∫ v·ªõi √¢m nh·∫°c, m·ªπ thu·∫≠t ho·∫∑c truy·ªÅn th√¥ng.', r:'A'},
    {t:'C√¢u 13: T√¥i th√≠ch gi√∫p ƒë·ª°, h∆∞·ªõng d·∫´n ho·∫∑c h·ªó tr·ª£ ng∆∞·ªùi kh√°c.', r:'S'},
    {t:'C√¢u 14: T√¥i c·∫£m th·∫•y vui khi l√†m vi·ªác nh√≥m.', r:'S'},
    {t:'C√¢u 15: T√¥i c√≥ xu h∆∞·ªõng l·∫Øng nghe v√† chia s·∫ª v·ªõi m·ªçi ng∆∞·ªùi.', r:'S'},
    {t:'C√¢u 16: T√¥i th√≠ch c√°c c√¥ng vi·ªác li√™n quan ƒë·∫øn gi√°o d·ª•c, y t·∫ø ho·∫∑c x√£ h·ªôi.', r:'S'},
    {t:'C√¢u 17: T√¥i th√≠ch l√£nh ƒë·∫°o ho·∫∑c thuy·∫øt ph·ª•c ng∆∞·ªùi kh√°c.', r:'E'},
    {t:'C√¢u 18: T√¥i h·ª©ng th√∫ v·ªõi kinh doanh, b√°n h√†ng ho·∫∑c t·ªï ch·ª©c ho·∫°t ƒë·ªông.', r:'E'},
    {t:'C√¢u 19: T√¥i t·ª± tin khi tr√¨nh b√†y √Ω ki·∫øn tr∆∞·ªõc ƒë√°m ƒë√¥ng.', r:'E'},
    {t:'C√¢u 20: T√¥i th√≠ch ƒë·∫∑t m·ª•c ti√™u v√† chinh ph·ª•c k·∫øt qu·∫£.', r:'E'},
    {t:'C√¢u 21: T√¥i th√≠ch c√¥ng vi·ªác r√µ r√†ng, c√≥ quy tr√¨nh c·ª• th·ªÉ.', r:'C'},
    {t:'C√¢u 22: T√¥i c·∫©n th·∫≠n v·ªõi s·ªë li·ªáu, h·ªì s∆° v√† gi·∫•y t·ªù.', r:'C'},
    {t:'C√¢u 23: T√¥i th√≠ch l√†m vi·ªác c√≥ k·∫ø ho·∫°ch, th·ªùi gian bi·ªÉu r√µ r√†ng.', r:'C'},
    {t:'C√¢u 24: T√¥i c·∫£m th·∫•y y√™n t√¢m khi m·ªçi vi·ªác ƒë∆∞·ª£c s·∫Øp x·∫øp g·ªçn g√†ng.', r:'C'},

    // PH·∫¶N 2 ‚Äì NƒÇNG L·ª∞C & K·ª∏ NƒÇNG (25‚Äì38)
    {t:'C√¢u 25: T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c th·ª±c h√†nh, thao t√°c tr·ª±c ti·∫øp.', r:'R'},
    {t:'C√¢u 26: T√¥i h·ªçc t·ªët c√°c m√¥n c·∫ßn t∆∞ duy logic v√† ph√¢n t√≠ch.', r:'I'},
    {t:'C√¢u 27: T√¥i s·ª≠ d·ª•ng m√°y t√≠nh v√† ph·∫ßn m·ªÅm h·ªçc t·∫≠p m·ªôt c√°ch hi·ªáu qu·∫£.', r:'C'},
    {t:'C√¢u 28: T√¥i giao ti·∫øp v√† tr√¨nh b√†y √Ω ki·∫øn kh√° t·ª± tin.', r:'E'},
    {t:'C√¢u 29: T√¥i l√†m t·ªët c√°c c√¥ng vi·ªác c·∫ßn thao t√°c tay ho·∫∑c k·ªπ thu·∫≠t.', r:'R'},
    {t:'C√¢u 30: T√¥i ti·∫øp thu nhanh khi ƒë∆∞·ª£c quan s√°t v√† l√†m th·ª≠.', r:'R'},
    {t:'C√¢u 31: T√¥i c√≥ kh·∫£ nƒÉng ph√¢n t√≠ch v·∫•n ƒë·ªÅ v√† t√¨m c√°ch gi·∫£i quy·∫øt.', r:'I'},
    {t:'C√¢u 32: T√¥i th√≠ch c√°c nhi·ªám v·ª• c·∫ßn suy lu·∫≠n, t√≠nh to√°n.', r:'I'},
    {t:'C√¢u 33: T√¥i c√≥ kh·∫£ nƒÉng s√°ng t·∫°o √Ω t∆∞·ªüng m·ªõi.', r:'A'},
    {t:'C√¢u 34: T√¥i th∆∞·ªùng c√≥ c√°ch l√†m ri√™ng, kh√¥ng th√≠ch b·ªã b√≥ bu·ªôc.', r:'A'},
    {t:'C√¢u 35: T√¥i c√≥ kh·∫£ nƒÉng l·∫Øng nghe v√† h·ªó tr·ª£ ng∆∞·ªùi kh√°c.', r:'S'},
    {t:'C√¢u 36: T√¥i c·∫£m th·∫•y tho·∫£i m√°i khi l√†m vi·ªác nh√≥m.', r:'S'},
    {t:'C√¢u 37: T√¥i t·ª± tin ƒë∆∞a ra √Ω ki·∫øn v√† d·∫´n d·∫Øt nh√≥m.', r:'E'},
    {t:'C√¢u 38: T√¥i l√†m vi·ªác hi·ªáu qu·∫£ khi c√≥ k·∫ø ho·∫°ch r√µ r√†ng.', r:'C'},

    // PH·∫¶N 3 ‚Äì GI√Å TR·ªä NGH·ªÄ NGHI·ªÜP & MONG MU·ªêN (39‚Äì46)
    {t:'C√¢u 39: T√¥i coi tr·ªçng vi·ªác ngh·ªÅ nghi·ªáp mang l·∫°i thu nh·∫≠p v√† c∆° h·ªôi thƒÉng ti·∫øn.', r:'E'},
    {t:'C√¢u 40: T√¥i mong mu·ªën c√¥ng vi·ªác ·ªïn ƒë·ªãnh, l√¢u d√†i.', r:'C'},
    {t:'C√¢u 41: T√¥i mu·ªën ngh·ªÅ nghi·ªáp c√≥ √≠ch cho x√£ h·ªôi v√† c·ªông ƒë·ªìng.', r:'S'},
    {t:'C√¢u 42: T√¥i coi tr·ªçng s·ª± s√°ng t·∫°o trong c√¥ng vi·ªác.', r:'A'},
    {t:'C√¢u 43: T√¥i mu·ªën ngh·ªÅ nghi·ªáp gi√∫p t√¥i ph√°t tri·ªÉn b·∫£n th√¢n.', r:'I'},
    {t:'C√¢u 44: T√¥i th√≠ch m√¥i tr∆∞·ªùng l√†m vi·ªác linh ho·∫°t, kh√¥ng g√≤ b√≥.', r:'A'},
    {t:'C√¢u 45: T√¥i coi tr·ªçng vi·ªác kh√¥ng ng·ª´ng h·ªçc h·ªèi v√† n√¢ng cao ki·∫øn th·ª©c.', r:'I'},
    {t:'C√¢u 46: T√¥i mong mu·ªën c√¥ng vi·ªác ph·∫£n √°nh gi√° tr·ªã c√° nh√¢n v√† c√≥ √Ω nghƒ©a.', r:'A'},

    // PH·∫¶N 4 ‚Äì ƒêI·ªÄU KI·ªÜN TH·ª∞C T·∫æ (47‚Äì50)
    {t:'C√¢u 47: T√¥i s·∫µn s√†ng h·ªçc t·∫≠p d√†i h·∫°n ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ph√π h·ª£p.', r:'I'},
    {t:'C√¢u 48: ƒêi·ªÅu ki·ªán t√†i ch√≠nh gia ƒë√¨nh cho ph√©p t√¥i h·ªçc t·∫≠p c√≥ k·∫ø ho·∫°ch.', r:'C'},
    {t:'C√¢u 49: Gia ƒë√¨nh ·ªßng h·ªô v√† t√¥n tr·ªçng l·ª±a ch·ªçn ngh·ªÅ nghi·ªáp c·ªßa t√¥i.', r:'S'},
    {t:'C√¢u 50: T√¥i s·∫µn s√†ng l·∫≠p k·∫ø ho·∫°ch c·ª• th·ªÉ ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ƒë√£ ch·ªçn.', r:'C'},
  ];

  const perTab = [24,14,8,4];
  let tab = 0;

  // L∆∞u tr·∫°ng th√°i l·ª±a ch·ªçn ƒë·ªÉ khi chuy·ªÉn tab v·∫´n gi·ªØ ƒë√°p √°n
  const DRAFT_KEY = 'careerVR_draft';
  let answers = Array.from({length:50}).map(()=>null); // 1..5

  function loadDraft(){
    try{
      const d = JSON.parse(localStorage.getItem(DRAFT_KEY) || 'null');
      if(d && Array.isArray(d.answers) && d.answers.length===50){
        answers = d.answers.map(v => (v===null? null : Number(v)));
      }
      if(d && d.profile){
        if($('name')) $('name').value = d.profile.name || $('name').value;
        if($('cls')) $('cls').value = d.profile.cls || $('cls').value;
        if($('school')) $('school').value = d.profile.school || $('school').value;
      }
    } catch {}
  }

  function saveDraft(){
    const profile = {
      name: $('name')?.value || '',
      cls: $('cls')?.value || '',
      school: $('school')?.value || ''
    };
    localStorage.setItem(DRAFT_KEY, JSON.stringify({answers, profile, time:new Date().toISOString()}));
  }

  loadDraft();

  // ===== Database ng√†nh/nh√≥m ng√†nh (demo) =====
  const majorsDb = [
    {name:'K·ªπ thu·∫≠t c∆° kh√≠ ‚Äì Ch·∫ø t·∫°o m√°y', code:'RIE', path:'THPT: To√°n‚ÄìL√Ω‚ÄìTin ‚Üí ƒêH/Cƒê C∆° kh√≠/Ch·∫ø t·∫°o ‚Üí K·ªπ s∆∞ c∆° kh√≠, k·ªπ s∆∞ s·∫£n xu·∫•t.'},
    {name:'C√¥ng ngh·ªá th√¥ng tin ‚Äì K·ªπ thu·∫≠t ph·∫ßn m·ªÅm', code:'IRC', path:'THPT: To√°n‚ÄìTin‚ÄìAnh ‚Üí CNTT ‚Üí L·∫≠p tr√¨nh Web/App/AI.'},
    {name:'ƒêi·ªán ‚Äì ƒêi·ªán t·ª≠ ‚Äì T·ª± ƒë·ªông ho√°', code:'RIE', path:'THPT: To√°n‚ÄìL√Ω ‚Üí ƒêi·ªán/ƒêi·ªán t·ª≠/T·ª± ƒë·ªông ho√° ‚Üí K·ªπ s∆∞ v·∫≠n h√†nh/thi·∫øt k·∫ø.'},
    {name:'Y khoa / ƒêi·ªÅu d∆∞·ª°ng / Y t·∫ø c√¥ng c·ªông', code:'SIR', path:'THPT: Sinh‚ÄìH√≥a ‚Üí Kh·ªëi s·ª©c kho·∫ª ‚Üí B√°c sƒ©/ƒêi·ªÅu d∆∞·ª°ng/KTV.'},
    {name:'T√¢m l√Ω h·ªçc ‚Äì C√¥ng t√°c x√£ h·ªôi', code:'SIA', path:'THPT: VƒÉn‚ÄìSinh ‚Üí T√¢m l√Ω/CTXH ‚Üí Tham v·∫•n, gi√°o d·ª•c, c·ªông ƒë·ªìng.'},
    {name:'Gi√°o d·ª•c ‚Äì S∆∞ ph·∫°m', code:'SAE', path:'THPT: VƒÉn‚ÄìS·ª≠/To√°n ‚Üí S∆∞ ph·∫°m ‚Üí Gi√°o vi√™n, qu·∫£n l√Ω gi√°o d·ª•c.'},
    {name:'Thi·∫øt k·∫ø ƒë·ªì ho·∫° ‚Äì Truy·ªÅn th√¥ng', code:'AES', path:'THPT: M·ªπ thu·∫≠t/VƒÉn ‚Üí Thi·∫øt k·∫ø/Truy·ªÅn th√¥ng ‚Üí Designer, content, media.'},
    {name:'Ki·∫øn tr√∫c ‚Äì Thi·∫øt k·∫ø n·ªôi th·∫•t', code:'ARE', path:'THPT: To√°n‚ÄìV·∫Ω ‚Üí Ki·∫øn tr√∫c/N·ªôi th·∫•t ‚Üí Ki·∫øn tr√∫c s∆∞, thi·∫øt k·∫ø.'},
    {name:'Kinh doanh ‚Äì Marketing', code:'EAS', path:'THPT: To√°n‚ÄìAnh ‚Üí QTKD/Marketing ‚Üí Sales, marketing, qu·∫£n tr·ªã.'},
    {name:'T√†i ch√≠nh ‚Äì K·∫ø to√°n', code:'CEI', path:'THPT: To√°n ‚Üí K·∫ø to√°n/T√†i ch√≠nh ‚Üí K·∫ø to√°n, ph√¢n t√≠ch t√†i ch√≠nh.'},
    {name:'Lu·∫≠t ‚Äì H√†nh ch√≠nh c√¥ng', code:'SEC', path:'THPT: VƒÉn‚ÄìS·ª≠ ‚Üí Lu·∫≠t/H√†nh ch√≠nh ‚Üí Lu·∫≠t s∆∞, c√¥ng ch·ª©c.'},
    {name:'Du l·ªãch ‚Äì Nh√† h√†ng ‚Äì Kh√°ch s·∫°n', code:'ESA', path:'THPT: Anh‚ÄìVƒÉn ‚Üí Du l·ªãch/QLKS ‚Üí L·ªÖ t√¢n, ƒëi·ªÅu h√†nh tour, qu·∫£n l√Ω.'},
  ];

  // ===== Render c√¢u h·ªèi theo tab (gi·ªØ ƒë√°p √°n khi chuy·ªÉn tab) =====
  window.showTab = function showTab(i){
    tab = i;
    document.querySelectorAll('.tab').forEach((t,idx)=>t.classList.toggle('active', idx===i));
    renderQuestions();
  };

  function renderQuestions(){
    const wrap = $('questions');
    if(!wrap) return;
    wrap.innerHTML = '';

    const start = perTab.slice(0,tab).reduce((a,b)=>a+b,0);
    const end = start + perTab[tab];

    riasecQuestions.slice(start,end).forEach((q,idx)=>{
      const qIndex = start + idx;
      const current = answers[qIndex];

      const html = `
        <div class='question card' style='padding:12px' data-q='${qIndex}'>
          <div style='display:flex;justify-content:space-between;gap:10px;align-items:flex-start'>
            <div style='font-weight:600'>${q.t}</div>
            <span class='pill'>${q.r}</span>
          </div>
          <div class='options' style='margin-top:8px'>
            ${[1,2,3,4,5].map(v=>
              `<label style='display:flex;gap:6px;align-items:center'>
                <input type='radio' name='q${qIndex}' value='${v}' ${current===v?'checked':''} />
                <span>${v}</span>
              </label>`
            ).join('')}
          </div>
        </div>
      `;

      wrap.insertAdjacentHTML('beforeend', html);
    });
  }

  function updateProgress(){
    const answered = answers.filter(v => v!==null).length;
    const bar = $('bar');
    const pt = $('progressText');
    if(bar) bar.style.width = (answered/50*100)+'%';
    if(pt) pt.textContent = `${answered} / 50 c√¢u`;
  }

  // ‚úÖ FIX ReferenceError: questionsWrap was missing
  const questionsWrap = $('questions');

  // Event delegation: c·∫≠p nh·∫≠t answers + l∆∞u draft
  if (questionsWrap) {
    questionsWrap.addEventListener('change', (ev) => {
      const inp = ev.target;
      if (!inp || inp.type !== 'radio') return;
      const name = inp.name || '';
      if (!name.startsWith('q')) return;
      const idx = Number(name.slice(1));
      const val = Number(inp.value);
      if (Number.isFinite(idx) && idx>=0 && idx<50) {
        answers[idx] = val;
        saveDraft();
        updateProgress();
      }
    });
  }

  window.resetRiasec = function resetRiasec(){
    answers = Array.from({length:50}).map(()=>null);
    localStorage.removeItem(DRAFT_KEY);
    document.querySelectorAll("input[type=radio]:checked").forEach(i=>i.checked=false);
    const res = $('riasecResult');
    if(res) res.style.display = 'none';
    renderQuestions();
    updateProgress();
    showTab(0);
  };

  // initial render
  renderQuestions();
  updateProgress();

  // l∆∞u profile khi nh·∫≠p
  ['name','cls','school'].forEach(id=>{
    const el = $(id);
    if(el) el.addEventListener('input', () => saveDraft());
  });

  // ===== Thu·∫≠t to√°n g·ª£i √Ω ng√†nh theo TOP 3 RIASEC =====
  function recommendMajors(top3){
    const topSet = new Set(top3);
    const scored = majorsDb.map(m=>{
      const codeSet = new Set(m.code.split(''));
      let common = 0;
      for(const ch of codeSet){ if(topSet.has(ch)) common++; }
      const match3 = top3.every(ch=>m.code.includes(ch));
      return {...m, common, match3};
    });

    let candidates = scored.filter(x=>x.common>=2);
    if(candidates.length<3) candidates = scored.filter(x=>x.common>=1);

    candidates.sort((a,b)=>{
      if(a.match3!==b.match3) return (b.match3?1:0)-(a.match3?1:0);
      if(b.common!==a.common) return b.common-a.common;
      return a.name.localeCompare(b.name,'vi');
    });

    const picks = candidates.slice(0,3);
    const backup = candidates[3] || null;
    return {picks: picks.slice(0, Math.min(3, picks.length)), backup};
  }

  // ===== Submit RIASEC =====
  const riasecForm = $('riasecForm');
  if (riasecForm) {
    riasecForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const scores = {R:0,I:0,A:0,S:0,E:0,C:0};
      let answeredCount = 0;
      for(let i=0;i<50;i++){
        const v = answers[i];
        if(v === null) continue;
        answeredCount++;
        const key = riasecQuestions[i].r;
        scores[key] += v;
      }

      if(answeredCount === 0){
        alert('B·∫°n ch∆∞a tr·∫£ l·ªùi c√¢u n√†o. Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 c√¢u ƒë·ªÉ xem k·∫øt qu·∫£.');
        return;
      }

      const top3 = Object.entries(scores)
        .sort((a,b)=>b[1]-a[1])
        .map(x=>x[0])
        .slice(0,3);

      const rec = recommendMajors(top3);

      const record = {
        name: $('name').value || '·∫®n danh',
        cls: $('cls').value || '-',
        school: $('school').value || '-',
        scores,
        riasec: top3,
        suggestedMajors: rec.picks.map(p=>({name:p.name, code:p.code, path:p.path, common:p.common, match3:p.match3})),
        backupMajor: rec.backup ? {name:rec.backup.name, code:rec.backup.code, path:rec.backup.path, common:rec.backup.common, match3:rec.backup.match3} : null,
        answeredCount,
        time: new Date().toISOString()
      };
      // ===== L∆ØU H·ªí S∆† H∆Ø·ªöNG NGHI·ªÜP HI·ªÜN T·∫†I (CHO AI & VR) =====
const careerProfile = {
  student: {
    name: record.name,
    class: record.cls,
    school: record.school
  },
  riasec: {
    scores: record.scores,
    top3: record.riasec,
    backup: record.backupMajor ? record.backupMajor.code[0] : null
  },
  suggestedMajors: record.suggestedMajors,
  createdAt: record.time
};

localStorage.setItem(
  'career_profile',
  JSON.stringify(careerProfile)
);

      const db = readDB();
      db.push(record);
      writeDB(db);

      const box = $('riasecResult');
      const top = $('riasecTop');
      const list = $('majorList');

      if(top){
        top.innerHTML = `
          <div style='display:flex;gap:8px;flex-wrap:wrap;align-items:center'>
            <span class='pill'>TOP 3 RIASEC: ${top3.join('-')}</span>
            <span class='pill muted'>ƒê√£ tr·∫£ l·ªùi: ${answeredCount}/50</span>
          </div>
          <div class='muted' style='margin-top:8px'>ƒêi·ªÉm RIASEC: R ${scores.R} ¬∑ I ${scores.I} ¬∑ A ${scores.A} ¬∑ S ${scores.S} ¬∑ E ${scores.E} ¬∑ C ${scores.C}</div>
        `;
      }

      if(list){
        const htmlPicks = rec.picks.map((m,idx)=>{
          const badge = m.match3 ? `<span class='pill'>Tr√πng 3/3</span>` : `<span class='pill'>Tr√πng ${m.common}/3</span>`;
          return `
            <div class='major'>
              <div style='display:flex;gap:8px;align-items:center;flex-wrap:wrap'>
                <h4 style='flex:1;margin:0'>${idx+1}. ${m.name}</h4>
                <span class='pill'>M√£: ${m.code}</span>
                ${badge}
              </div>
              <p><strong>L·ªô tr√¨nh:</strong> ${m.path}</p>
            </div>`;
        }).join('');

        const htmlBackup = rec.backup ? `
          <div class='major'>
            <div style='display:flex;gap:8px;align-items:center;flex-wrap:wrap'>
              <h4 style='flex:1;margin:0'>D·ª± ph√≤ng: ${rec.backup.name}</h4>
              <span class='pill'>M√£: ${rec.backup.code}</span>
              <span class='pill'>Tr√πng ${rec.backup.common}/3</span>
            </div>
            <p><strong>L·ªô tr√¨nh:</strong> ${rec.backup.path}</p>
          </div>` : `<div class='muted'>Ch∆∞a c√≥ ng√†nh d·ª± ph√≤ng (c·∫ßn m·ªü r·ªông c∆° s·ªü d·ªØ li·ªáu ng√†nh).</div>`;

        list.innerHTML = htmlPicks + htmlBackup;
      }

      if(box) box.style.display = 'block';

      syncExperienceFromLast();
      showChat();
      showDashboard();
    });
  }

  // ===== Experience =====
  function syncExperienceFromLast(){
    const box = $('careerSuggest');
    if(!box) return;

    const db = readDB();
    if(!db.length){
      box.innerHTML = '<div class="muted">Ch∆∞a c√≥ k·∫øt qu·∫£ RIASEC. Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.</div>';
      return;
    }

    const last = db[db.length-1];
    const majors = last.suggestedMajors || [];
    const backup = last.backupMajor;

    const majorsHtml = majors.map((m,idx)=>`
      <div class='major'>
        <div style='display:flex;gap:8px;align-items:center;flex-wrap:wrap'>
          <h4 style='flex:1;margin:0'>${idx+1}. ${m.name}</h4>
          <span class='pill'>${m.code}</span>
          <span class='pill'>${m.match3 ? 'Tr√πng 3/3' : `Tr√πng ${m.common}/3`}</span>
        </div>
        <p><strong>L·ªô tr√¨nh:</strong> ${m.path}</p>
        <p class='muted' style='margin-top:6px'>G·ª£i √Ω ti·∫øp theo: b·∫°n c√≥ th·ªÉ ch·ªçn ngh·ªÅ ƒë·ªÉ xem VR & mini-task (s·∫Ω b·ªï sung ·ªü b∆∞·ªõc ti·∫øp theo).</p>
      </div>
    `).join('');

    const backupHtml = backup ? `
      <div class='major'>
        <h4 style='margin:0 0 6px 0'>D·ª± ph√≤ng: ${backup.name} <span class='pill'>${backup.code}</span></h4>
        <p><strong>L·ªô tr√¨nh:</strong> ${backup.path}</p>
      </div>` : '';

    box.innerHTML = `
      <div style='display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px'>
        <span class='pill'>RIASEC: ${last.riasec.join('-')}</span>
        <span class='pill muted'>HS: ${last.name} ¬∑ ${last.cls} ¬∑ ${last.school}</span>
      </div>
      ${majorsHtml || '<div class="muted">Ch∆∞a c√≥ g·ª£i √Ω ng√†nh. H√£y ho√†n th√†nh tr·∫Øc nghi·ªám.</div>'}
      ${backupHtml}
    `;
  }
  window.syncExperienceFromLast = syncExperienceFromLast;

  // ===== Chatbot =====
  function showChat(){
    const ctx = $('chatContext');
    const list = $('chatSuggest');
    if(!ctx || !list) return;

    const db = readDB();
    if(!db.length){
      ctx.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu RIASEC. Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.';
      list.innerHTML = '';
      return;
    }

    const last = db[db.length-1];
    ctx.innerHTML = `
      <div style='display:flex;gap:8px;flex-wrap:wrap'>
        <span class='pill'>RIASEC: ${last.riasec.join('-')}</span>
        <span class='pill muted'>HS: ${last.name} ¬∑ ${last.cls} ¬∑ ${last.school}</span>
      </div>
      <div class='muted' style='margin-top:8px;font-size:13px'>AI s·∫Ω ∆∞u ti√™n t∆∞ v·∫•n theo t·ªï h·ª£p 3 ch·ªØ RIASEC v√† g·ª£i √Ω ng√†nh/l·ªô tr√¨nh t∆∞∆°ng ·ª©ng.</div>
    `;

    const majors = last.suggestedMajors || [];
    const backup = last.backupMajor;

    const items = majors.map(m=>`
      <li>
        <strong>${m.name}</strong> <span class='pill'>${m.code}</span><br>
        <span class='muted'>L·ªô tr√¨nh: ${m.path}</span>
      </li>
    `).join('');

    const bk = backup ? `
      <li>
        <strong>D·ª± ph√≤ng:</strong> ${backup.name} <span class='pill'>${backup.code}</span><br>
        <span class='muted'>L·ªô tr√¨nh: ${backup.path}</span>
      </li>
    ` : '';

    list.innerHTML = items + bk;
  }
  window.showChat = showChat;

  // ===== Dashboard =====
  function showDashboard(){
    const wrap = $('dashboardData');
    if(!wrap) return;

    const db = readDB();
    if(!db.length){
      wrap.innerHTML = '<div class="muted">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y l√†m RIASEC tr∆∞·ªõc.</div>';
      return;
    }

    const bySchool = {};
    const byClass = {};
    for(const r of db){
      const sch = r.school || '-';
      const clsKey = `${r.school || '-'} | ${r.cls || '-'}`;
      bySchool[sch] = (bySchool[sch] || 0) + 1;
      byClass[clsKey] = (byClass[clsKey] || 0) + 1;
    }

    const schoolHtml = Object.entries(bySchool)
      .sort((a,b)=>b[1]-a[1])
      .map(([k,v])=>`<div class='major'><h4 style='margin:0'>${k}</h4><p class='muted'>S·ªë l∆∞·ª£t l√†m: ${v}</p></div>`)
      .join('');

    const classHtml = Object.entries(byClass)
      .sort((a,b)=>b[1]-a[1])
      .map(([k,v])=>`<div class='major'><h4 style='margin:0'>${k}</h4><p class='muted'>S·ªë l∆∞·ª£t l√†m: ${v}</p></div>`)
      .join('');

    const latest = db[db.length-1];
    const latestMajors = (latest.suggestedMajors || []).map(m=>`<li>${m.name} <span class='pill'>${m.code}</span></li>`).join('');

    wrap.innerHTML = `
      <div class='card'>
        <h4 style='margin-top:0'>B·∫£n ghi g·∫ßn nh·∫•t</h4>
        <div class='muted'>${latest.name} ‚Äì ${latest.cls} ‚Äì ${latest.school} ‚Äì RIASEC: ${latest.riasec.join('-')} ‚Äì Tr·∫£ l·ªùi: ${(latest.answeredCount ?? 0)}/50</div>
        <div style='margin-top:8px'><strong>G·ª£i √Ω ng√†nh:</strong><ul>${latestMajors || '<li class="muted">(ch∆∞a c√≥)</li>'}</ul></div>
      </div>
      <div class='card'>
        <h4 style='margin-top:0'>Th·ªëng k√™ theo Tr∆∞·ªùng</h4>
        ${schoolHtml}
      </div>
      <div class='card'>
        <h4 style='margin-top:0'>Th·ªëng k√™ theo L·ªõp</h4>
        ${classHtml}
      </div>
    `;
  }
  window.showDashboard = showDashboard;

  window.clearAllData = function clearAllData(){
    if(!confirm('Xo√° to√†n b·ªô d·ªØ li·ªáu tr·∫Øc nghi·ªám ƒë√£ l∆∞u tr√™n tr√¨nh duy·ªát n√†y?')) return;
    writeDB([]);
    showDashboard();
    syncExperienceFromLast();
    showChat();
    alert('ƒê√£ xo√° d·ªØ li·ªáu.');
  };

  // ===== Self-tests (console) =====
  function runSelfTests(){
    const tests = [];
    const assert = (name, cond) => tests.push({name, pass: !!cond});

    assert('riasecQuestions has 50', riasecQuestions.length === 50);
    assert('perTab sums to 50', perTab.reduce((a,b)=>a+b,0) === 50);
    assert('all questions have RIASEC letter', riasecQuestions.every(q => ['R','I','A','S','E','C'].includes(q.r)));
    assert('answers has 50 slots', Array.isArray(answers) && answers.length === 50);
    assert('questionsWrap exists', !!questionsWrap);

    const failed = tests.filter(t=>!t.pass);
    if(failed.length){
      console.warn('Self-tests failed:', failed);
      window.__careerVR_tests = {pass:false, tests};
    } else {
      console.log('Self-tests passed:', tests.length);
      window.__careerVR_tests = {pass:true, tests};
    }
  }
  runSelfTests();

  // initial page
  const initial = (location.hash || '#home').replace('#','');
  go(pages.some(p=>p.id===initial) ? initial : 'home');
})();
</script>
</body>
</html>
